#!/bin/bash

setenforce 0
sysctl -w vm.max_map_count=262144

#Creación y configuración de directorios para elasticsearch
mkdir -p /var/containers/wazuh/elk/elasticsearch/
echo "IyA9PT09PT09PT09PT09PT09PT09IEVTTEFTVElDU0VBUkNIOiBlbGFzdGljc2VhcmNoLnltbCA9PT09PT09PT09PT09PT09PT09PT09ICMKY2x1c3Rlci5uYW1lOiAiZG9ja2VyLWNsdXN0ZXIiCm5ldHdvcmsuaG9zdDogMC4wLjAuMAojIG1pbmltdW1fbWFzdGVyX25vZGVzIG5lZWQgdG8gYmUgZXhwbGljaXRseSBzZXQgd2hlbiBib3VuZCBvbiBhIHB1YmxpYyBJUAojIHNldCB0byAxIHRvIGFsbG93IHNpbmdsZSBub2RlIGNsdXN0ZXJzCiMgRGV0YWlsczogaHR0cHM6Ly9naXRodWIuY29tL2VsYXN0aWMvZWxhc3RpY3NlYXJjaC9wdWxsLzE3Mjg4CmRpc2NvdmVyeS56ZW4ubWluaW11bV9tYXN0ZXJfbm9kZXM6IDE=" | base64 -w0 -d > /var/containers/wazuh/elk/elasticsearch/elasticsearch.yml
docker run --name=elasticsearch_wazuh -p 9200:9200 -p 9300:9300 -d -e "discovery.type=single-node" -v /var/containers/wazuh/elk/elasticsearch/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml:z docker.elastic.co/elasticsearch/elasticsearch:6.4.2
echo "Elasticsearch creado"

#Creación y configuración de directorios para logstash
mkdir -p /var/containers/wazuh/logstash/pipeline/
echo "IyA9PT09PT09PT09PT09PT09PT09IExvZ3N0YXNoOiBwaXBlbGluZS55bWwgPT09PT09PT09PT09PT09PT09PT09PSAjCmlucHV0eyAgCiAgICBiZWF0c3sKICAgICAgICBwb3J0ID0+ICI1MDAwIiAgfQp9Cm91dHB1dHsgIAogICAgZWxhc3RpY3NlYXJjaCB7CiAgICAgICAgaG9zdHMgPT4gWydodHRwOi8vZWxhc3RpY3NlYXJjaDo5MjAwJ10gI0lQIHkgcHVlcnRvIGRlbCBjb250ZW5lZG9yIGRlIEVsYXN0aWNzZWFyY2gKICAgICAgICBpbmRleCA9PiAibG9nc3Rhc2gtJXsrWVlZWS5NTS5kZH0iICNOb21icmUgZGVsIGluZGljZSAgCiAgICAgICAgfQp9Cg==" | base64 -w0 -d > /var/containers/wazuh/logstash/pipeline/pipeline.conf
#Creación de contenedor de logstash
docker run --rm -d --name=logstash_wazuh --link=elasticsearch_wazuh:elasticsearch -v /var/containers/wazuh/logstash/pipeline/:/usr/share/logstash/pipeline/bin:z docker.elastic.co/logstash/logstash-oss:6.2.1
echo "Logstash creado"

#Creación y configuración de directorios para wazuh
mkdir -p /var/containers/wazuh/wazuh/wazuh-config-mount/etc/
mkdir -p /var/containers/wazuh/wazuh/etc/filebeat/
echo "IyA9PT09PT09PT09PT09PT09PT09IEZpbGViZWF0OiBmaWxlYmVhdC55bWwgPT09PT09PT09PT09PT09PT09PT09PSAjCmZpbGViZWF0LmNvbmZpZzogIAogIHByb3NwZWN0b3JzOgogICAgcGF0aDogJHtwYXRoLmNvbmZpZ30vcHJvc3BlY3RvcnMuZC8qLnltbCAgICAgIAogICAgcmVsb2FkLmVuYWJsZWQ6IGZhbHNlICAKICBtb2R1bGVzOgogICAgcGF0aDogJHtwYXRoLmNvbmZpZ30vbW9kdWxlcy5kLyoueW1sCiAgICByZWxvYWQuZW5hYmxlZDogZmFsc2UKICAKcHJvY2Vzc29yczoKLSBhZGRfY2xvdWRfbWV0YWRhdGE6CgpvdXRwdXQubG9nc3Rhc2g6ICAKICBob3N0czogWydsb2dzdGFzaDo1MDAwJ10gI2lwIG8gbm9tYnJlIGRlIGRvbWluaW8gZGUgbG9nc3Rhc2gK" | base64 -w0 -d > /var/containers/wazuh/wazuh/etc/filebeat/filebeat.yml
echo "PCEtLQogIFdhenVoIC0gTWFuYWdlciAtIERlZmF1bHQgY29uZmlndXJhdGlvbi4KICBNb3JlIGluZm8gYXQ6IGh0dHBzOi8vZG9jdW1lbnRhdGlvbi53YXp1aC5jb20KICBNYWlsaW5nIGxpc3Q6IGh0dHBzOi8vZ3JvdXBzLmdvb2dsZS5jb20vZm9ydW0vIyFmb3J1bS93YXp1aAotLT4KCjxvc3NlY19jb25maWc+CiAgPGdsb2JhbD4KICAgIDxqc29ub3V0X291dHB1dD55ZXM8L2pzb25vdXRfb3V0cHV0PgogICAgPGFsZXJ0c19sb2c+eWVzPC9hbGVydHNfbG9nPgogICAgPGxvZ2FsbD5ubzwvbG9nYWxsPgogICAgPGxvZ2FsbF9qc29uPm5vPC9sb2dhbGxfanNvbj4KICA8IS0tICA8ZW1haWxfbm90aWZpY2F0aW9uPm5vPC9lbWFpbF9ub3RpZmljYXRpb24+CiAgICA8c210cF9zZXJ2ZXI+c210cC5leGFtcGxlLndhenVoLmNvbTwvc210cF9zZXJ2ZXI+CiAgICA8ZW1haWxfZnJvbT5vc3NlY21AZXhhbXBsZS53YXp1aC5jb208L2VtYWlsX2Zyb20+CiAgICA8ZW1haWxfdG8+cmVjaXBpZW50QGV4YW1wbGUud2F6dWguY29tPC9lbWFpbF90bz4KICAgIDxlbWFpbF9tYXhwZXJob3VyPjEyPC9lbWFpbF9tYXhwZXJob3VyPiAtLT4KICA8L2dsb2JhbD4KCiAgPCEtLSBDaG9vc2UgYmV0d2VlbiBwbGFpbiBvciBqc29uIGZvcm1hdCAob3IgYm90aCkgZm9yIGludGVybmFsIGxvZ3MgLS0+CiAgPGxvZ2dpbmc+CiAgICA8bG9nX2Zvcm1hdD5wbGFpbjwvbG9nX2Zvcm1hdD4KICA8L2xvZ2dpbmc+CgogIDxhbGVydHM+CiAgICA8bG9nX2FsZXJ0X2xldmVsPjM8L2xvZ19hbGVydF9sZXZlbD4KICAgIDxlbWFpbF9hbGVydF9sZXZlbD4xMjwvZW1haWxfYWxlcnRfbGV2ZWw+CiAgPC9hbGVydHM+CgogIDxyZW1vdGU+CiAgICA8Y29ubmVjdGlvbj5zZWN1cmU8L2Nvbm5lY3Rpb24+CiAgICA8cG9ydD4xNTE0PC9wb3J0PgogICAgPHByb3RvY29sPnVkcDwvcHJvdG9jb2w+CiAgPC9yZW1vdGU+CgogIDwhLS0gUG9saWN5IG1vbml0b3JpbmcgLS0+CiAgPHJvb3RjaGVjaz4KICAgIDxkaXNhYmxlZD5ubzwvZGlzYWJsZWQ+CgogICAgPCEtLSBGcmVxdWVuY3kgdGhhdCByb290Y2hlY2sgaXMgZXhlY3V0ZWQgLSBldmVyeSAxMiBob3VycyAtLT4KICAgIDxmcmVxdWVuY3k+NDMyMDA8L2ZyZXF1ZW5jeT4KCiAgICA8cm9vdGtpdF9maWxlcz4vdmFyL29zc2VjL2V0Yy9zaGFyZWQvcm9vdGtpdF9maWxlcy50eHQ8L3Jvb3RraXRfZmlsZXM+CiAgICA8cm9vdGtpdF90cm9qYW5zPi92YXIvb3NzZWMvZXRjL3NoYXJlZC9yb290a2l0X3Ryb2phbnMudHh0PC9yb290a2l0X3Ryb2phbnM+CgogICAgPHN5c3RlbV9hdWRpdD4vdmFyL29zc2VjL2V0Yy9zaGFyZWQvc3lzdGVtX2F1ZGl0X3JjbC50eHQ8L3N5c3RlbV9hdWRpdD4KICAgIDxzeXN0ZW1fYXVkaXQ+L3Zhci9vc3NlYy9ldGMvc2hhcmVkL3N5c3RlbV9hdWRpdF9zc2gudHh0PC9zeXN0ZW1fYXVkaXQ+CiAgICA8c3lzdGVtX2F1ZGl0Pi92YXIvb3NzZWMvZXRjL3NoYXJlZC9jaXNfZGViaWFuX2xpbnV4X3JjbC50eHQ8L3N5c3RlbV9hdWRpdD4KCiAgICA8c2tpcF9uZnM+eWVzPC9za2lwX25mcz4KICA8L3Jvb3RjaGVjaz4KCiAgPHdvZGxlIG5hbWU9Im9wZW4tc2NhcCI+CiAgICA8ZGlzYWJsZWQ+eWVzPC9kaXNhYmxlZD4KICAgIDx0aW1lb3V0PjE4MDA8L3RpbWVvdXQ+CiAgICA8aW50ZXJ2YWw+MWQ8L2ludGVydmFsPgogICAgPHNjYW4tb24tc3RhcnQ+eWVzPC9zY2FuLW9uLXN0YXJ0PgoKICAgIDxjb250ZW50IHR5cGU9InhjY2RmIiBwYXRoPSJzc2ctZGViaWFuLTgtZHMueG1sIj4KICAgICAgPHByb2ZpbGU+eGNjZGZfb3JnLnNzZ3Byb2plY3QuY29udGVudF9wcm9maWxlX2NvbW1vbjwvcHJvZmlsZT4KICAgIDwvY29udGVudD4KICAgIDxjb250ZW50IHR5cGU9Im92YWwiIHBhdGg9ImN2ZS1kZWJpYW4tb3ZhbC54bWwiLz4KICA8L3dvZGxlPgoKICA8d29kbGUgbmFtZT0ic3lzY29sbGVjdG9yIj4KICAgIDxkaXNhYmxlZD5ubzwvZGlzYWJsZWQ+CiAgICA8aW50ZXJ2YWw+MWg8L2ludGVydmFsPgogICAgPHNjYW5fb25fc3RhcnQ+eWVzPC9zY2FuX29uX3N0YXJ0PgogICAgPGhhcmR3YXJlPnllczwvaGFyZHdhcmU+CiAgICA8b3M+eWVzPC9vcz4KICAgIDxuZXR3b3JrPnllczwvbmV0d29yaz4KICA8L3dvZGxlPgoKICA8d29kbGUgbmFtZT0idnVsbmVyYWJpbGl0eS1kZXRlY3RvciI+CiAgICA8ZGlzYWJsZWQ+bm88L2Rpc2FibGVkPgogICAgPGludGVydmFsPjFkPC9pbnRlcnZhbD4KICAgIDxydW5fb25fc3RhcnQ+eWVzPC9ydW5fb25fc3RhcnQ+CiAgICA8dXBkYXRlX3VidW50dV9vdmFsIGludGVydmFsPSI2MG0iIHZlcnNpb249IjE2LDE0LDEyIj55ZXM8L3VwZGF0ZV91YnVudHVfb3ZhbD4KICAgIDx1cGRhdGVfcmVkaGF0X292YWwgaW50ZXJ2YWw9IjYwbSIgdmVyc2lvbj0iNyw2LDUiPnllczwvdXBkYXRlX3JlZGhhdF9vdmFsPgogIDwvd29kbGU+CgogIDwhLS0gRmlsZSBpbnRlZ3JpdHkgbW9uaXRvcmluZyAtLT4KICA8c3lzY2hlY2s+CiAgICA8ZGlzYWJsZWQ+bm88L2Rpc2FibGVkPgoKICAgIDwhLS0gRnJlcXVlbmN5IHRoYXQgc3lzY2hlY2sgaXMgZXhlY3V0ZWQgZGVmYXVsdCBldmVyeSAxMiBob3VycyAtLT4KICAgIDxmcmVxdWVuY3k+NDMyMDA8L2ZyZXF1ZW5jeT4KCiAgICA8c2Nhbl9vbl9zdGFydD55ZXM8L3NjYW5fb25fc3RhcnQ+CgogICAgPCEtLSBHZW5lcmF0ZSBhbGVydCB3aGVuIG5ldyBmaWxlIGRldGVjdGVkIC0tPgogICAgPGFsZXJ0X25ld19maWxlcz55ZXM8L2FsZXJ0X25ld19maWxlcz4KCiAgICA8IS0tIERvbid0IGlnbm9yZSBmaWxlcyB0aGF0IGNoYW5nZSBtb3JlIHRoYW4gMyB0aW1lcyAtLT4KICAgIDxhdXRvX2lnbm9yZT5ubzwvYXV0b19pZ25vcmU+CgogICAgPCEtLSBEaXJlY3RvcmllcyB0byBjaGVjayAgKHBlcmZvcm0gYWxsIHBvc3NpYmxlIHZlcmlmaWNhdGlvbnMpIC0tPgogICAgPGRpcmVjdG9yaWVzIGNoZWNrX2FsbD0ieWVzIj4vZXRjLC91c3IvYmluLC91c3Ivc2JpbjwvZGlyZWN0b3JpZXM+CiAgICA8ZGlyZWN0b3JpZXMgY2hlY2tfYWxsPSJ5ZXMiPi9iaW4sL3NiaW4sL2Jvb3Q8L2RpcmVjdG9yaWVzPgoKICAgIDwhLS0gRmlsZXMvZGlyZWN0b3JpZXMgdG8gaWdub3JlIC0tPgogICAgPGlnbm9yZT4vZXRjL210YWI8L2lnbm9yZT4KICAgIDxpZ25vcmU+L2V0Yy9ob3N0cy5kZW55PC9pZ25vcmU+CiAgICA8aWdub3JlPi9ldGMvbWFpbC9zdGF0aXN0aWNzPC9pZ25vcmU+CiAgICA8aWdub3JlPi9ldGMvcmFuZG9tLXNlZWQ8L2lnbm9yZT4KICAgIDxpZ25vcmU+L2V0Yy9yYW5kb20uc2VlZDwvaWdub3JlPgogICAgPGlnbm9yZT4vZXRjL2FkanRpbWU8L2lnbm9yZT4KICAgIDxpZ25vcmU+L2V0Yy9odHRwZC9sb2dzPC9pZ25vcmU+CiAgICA8aWdub3JlPi9ldGMvdXRtcHg8L2lnbm9yZT4KICAgIDxpZ25vcmU+L2V0Yy93dG1weDwvaWdub3JlPgogICAgPGlnbm9yZT4vZXRjL2N1cHMvY2VydHM8L2lnbm9yZT4KICAgIDxpZ25vcmU+L2V0Yy9kdW1wZGF0ZXM8L2lnbm9yZT4KICAgIDxpZ25vcmU+L2V0Yy9zdmMvdm9sYXRpbGU8L2lnbm9yZT4KICAgIDxpZ25vcmU+L3N5cy9rZXJuZWwvc2VjdXJpdHk8L2lnbm9yZT4KICAgIDxpZ25vcmU+L3N5cy9rZXJuZWwvZGVidWc8L2lnbm9yZT4KCiAgICA8IS0tIENoZWNrIHRoZSBmaWxlLCBidXQgbmV2ZXIgY29tcHV0ZSB0aGUgZGlmZiAtLT4KICAgIDxub2RpZmY+L2V0Yy9zc2wvcHJpdmF0ZS5rZXk8L25vZGlmZj4KCiAgICA8c2tpcF9uZnM+eWVzPC9za2lwX25mcz4KICA8L3N5c2NoZWNrPgoKICA8IS0tIEFjdGl2ZSByZXNwb25zZSAtLT4KICA8Z2xvYmFsPgogICAgPHdoaXRlX2xpc3Q+MTI3LjAuMC4xPC93aGl0ZV9saXN0PgogICAgPHdoaXRlX2xpc3Q+XmxvY2FsaG9zdC5sb2NhbGRvbWFpbiQ8L3doaXRlX2xpc3Q+CiAgICA8d2hpdGVfbGlzdD4xMC4wLjAuMjwvd2hpdGVfbGlzdD4KICA8L2dsb2JhbD4KCiAgPGNvbW1hbmQ+CiAgICA8bmFtZT5kaXNhYmxlLWFjY291bnQ8L25hbWU+CiAgICA8ZXhlY3V0YWJsZT5kaXNhYmxlLWFjY291bnQuc2g8L2V4ZWN1dGFibGU+CiAgICA8ZXhwZWN0PnVzZXI8L2V4cGVjdD4KICAgIDx0aW1lb3V0X2FsbG93ZWQ+eWVzPC90aW1lb3V0X2FsbG93ZWQ+CiAgPC9jb21tYW5kPgoKICA8Y29tbWFuZD4KICAgIDxuYW1lPnJlc3RhcnQtb3NzZWM8L25hbWU+CiAgICA8ZXhlY3V0YWJsZT5yZXN0YXJ0LW9zc2VjLnNoPC9leGVjdXRhYmxlPgogICAgPGV4cGVjdD48L2V4cGVjdD4KICA8L2NvbW1hbmQ+CgogIDxjb21tYW5kPgogICAgPG5hbWU+ZmlyZXdhbGwtZHJvcDwvbmFtZT4KICAgIDxleGVjdXRhYmxlPmZpcmV3YWxsLWRyb3Auc2g8L2V4ZWN1dGFibGU+CiAgICA8ZXhwZWN0PnNyY2lwPC9leHBlY3Q+CiAgICA8dGltZW91dF9hbGxvd2VkPnllczwvdGltZW91dF9hbGxvd2VkPgogIDwvY29tbWFuZD4KCiAgPGNvbW1hbmQ+CiAgICA8bmFtZT5ob3N0LWRlbnk8L25hbWU+CiAgICA8ZXhlY3V0YWJsZT5ob3N0LWRlbnkuc2g8L2V4ZWN1dGFibGU+CiAgICA8ZXhwZWN0PnNyY2lwPC9leHBlY3Q+CiAgICA8dGltZW91dF9hbGxvd2VkPnllczwvdGltZW91dF9hbGxvd2VkPgogIDwvY29tbWFuZD4KCiAgPGNvbW1hbmQ+CiAgICA8bmFtZT5yb3V0ZS1udWxsPC9uYW1lPgogICAgPGV4ZWN1dGFibGU+cm91dGUtbnVsbC5zaDwvZXhlY3V0YWJsZT4KICAgIDxleHBlY3Q+c3JjaXA8L2V4cGVjdD4KICAgIDx0aW1lb3V0X2FsbG93ZWQ+eWVzPC90aW1lb3V0X2FsbG93ZWQ+CiAgPC9jb21tYW5kPgoKICA8Y29tbWFuZD4KICAgIDxuYW1lPndpbl9yb3V0ZS1udWxsPC9uYW1lPgogICAgPGV4ZWN1dGFibGU+cm91dGUtbnVsbC5jbWQ8L2V4ZWN1dGFibGU+CiAgICA8ZXhwZWN0PnNyY2lwPC9leHBlY3Q+CiAgICA8dGltZW91dF9hbGxvd2VkPnllczwvdGltZW91dF9hbGxvd2VkPgogIDwvY29tbWFuZD4KCiAgPCEtLQogIDxhY3RpdmUtcmVzcG9uc2U+CiAgICBhY3RpdmUtcmVzcG9uc2Ugb3B0aW9ucyBoZXJlCiAgPC9hY3RpdmUtcmVzcG9uc2U+CiAgLS0+CgogIDwhLS0gTG9nIGFuYWx5c2lzIC0tPgogIDxsb2NhbGZpbGU+CiAgICA8bG9nX2Zvcm1hdD5zeXNsb2c8L2xvZ19mb3JtYXQ+CiAgICA8bG9jYXRpb24+L3Zhci9vc3NlYy9sb2dzL2FjdGl2ZS1yZXNwb25zZXMubG9nPC9sb2NhdGlvbj4KICA8L2xvY2FsZmlsZT4KCiAgPGxvY2FsZmlsZT4KICAgIDxsb2dfZm9ybWF0PnN5c2xvZzwvbG9nX2Zvcm1hdD4KICAgIDxsb2NhdGlvbj4vdmFyL2xvZy9tZXNzYWdlczwvbG9jYXRpb24+CiAgPC9sb2NhbGZpbGU+CgogIDxsb2NhbGZpbGU+CiAgICA8bG9nX2Zvcm1hdD5zeXNsb2c8L2xvZ19mb3JtYXQ+CiAgICA8bG9jYXRpb24+L3Zhci9sb2cvYXV0aC5sb2c8L2xvY2F0aW9uPgogIDwvbG9jYWxmaWxlPgoKICA8bG9jYWxmaWxlPgogICAgPGxvZ19mb3JtYXQ+c3lzbG9nPC9sb2dfZm9ybWF0PgogICAgPGxvY2F0aW9uPi92YXIvbG9nL3N5c2xvZzwvbG9jYXRpb24+CiAgPC9sb2NhbGZpbGU+CgogIDxsb2NhbGZpbGU+CiAgICA8bG9nX2Zvcm1hdD5jb21tYW5kPC9sb2dfZm9ybWF0PgogICAgPGNvbW1hbmQ+ZGYgLVA8L2NvbW1hbmQ+CiAgICA8ZnJlcXVlbmN5PjM2MDwvZnJlcXVlbmN5PgogIDwvbG9jYWxmaWxlPgoKICA8bG9jYWxmaWxlPgogICAgPGxvZ19mb3JtYXQ+ZnVsbF9jb21tYW5kPC9sb2dfZm9ybWF0PgogICAgPGNvbW1hbmQ+bmV0c3RhdCAtdGFuIHxncmVwIExJU1RFTiB8Z3JlcCAtdiAxMjcuMC4wLjEgfCBzb3J0PC9jb21tYW5kPgogICAgPGZyZXF1ZW5jeT4zNjA8L2ZyZXF1ZW5jeT4KICA8L2xvY2FsZmlsZT4KCiAgPGxvY2FsZmlsZT4KICAgIDxsb2dfZm9ybWF0PmZ1bGxfY29tbWFuZDwvbG9nX2Zvcm1hdD4KICAgIDxjb21tYW5kPmxhc3QgLW4gNTwvY29tbWFuZD4KICAgIDxmcmVxdWVuY3k+MzYwPC9mcmVxdWVuY3k+CiAgPC9sb2NhbGZpbGU+CgogIDxsb2NhbGZpbGU+CiAgICA8bG9jYXRpb24+L3Zhci9sb2cvKi5sb2c8L2xvY2F0aW9uPgogICAgPGxvZ19mb3JtYXQ+c3lzbG9nPC9sb2dfZm9ybWF0PgogIDwvbG9jYWxmaWxlPgoKICA8cnVsZXNldD4KICAgIDwhLS0gRGVmYXVsdCBydWxlc2V0IC0tPgogICAgPGRlY29kZXJfZGlyPnJ1bGVzZXQvZGVjb2RlcnM8L2RlY29kZXJfZGlyPgogICAgPHJ1bGVfZGlyPnJ1bGVzZXQvcnVsZXM8L3J1bGVfZGlyPgogICAgPHJ1bGVfZXhjbHVkZT4wMjE1LXBvbGljeV9ydWxlcy54bWw8L3J1bGVfZXhjbHVkZT4KICAgIDxsaXN0PmV0Yy9saXN0cy9hdWRpdC1rZXlzPC9saXN0PgoKICAgIDwhLS0gVXNlci1kZWZpbmVkIHJ1bGVzZXQgLS0+CiAgICA8ZGVjb2Rlcl9kaXI+ZXRjL2RlY29kZXJzPC9kZWNvZGVyX2Rpcj4KICAgIDxydWxlX2Rpcj5ldGMvcnVsZXM8L3J1bGVfZGlyPgogIDwvcnVsZXNldD4KCiAgPCEtLSBDb25maWd1cmF0aW9uIGZvciBvc3NlYy1hdXRoZAogICAgICAgVG8gZW5hYmxlIHRoaXMgc2VydmljZSwgcnVuOgogICAgICAgb3NzZWMtY29udHJvbCBlbmFibGUgYXV0aAogIC0tPgogIDxhdXRoPgogICAgPGRpc2FibGVkPm5vPC9kaXNhYmxlZD4KICAgIDxwb3J0PjE1MTU8L3BvcnQ+CiAgICA8dXNlX3NvdXJjZV9pcD55ZXM8L3VzZV9zb3VyY2VfaXA+CiAgICA8Zm9yY2VfaW5zZXJ0PnllczwvZm9yY2VfaW5zZXJ0PgogICAgPGZvcmNlX3RpbWU+MDwvZm9yY2VfdGltZT4KICAgIDxwdXJnZT55ZXM8L3B1cmdlPgogICAgPHVzZV9wYXNzd29yZD5ubzwvdXNlX3Bhc3N3b3JkPgogICAgPCEtLSA8c3NsX2FnZW50X2NhPjwvc3NsX2FnZW50X2NhPiAtLT4KICAgIDxzc2xfdmVyaWZ5X2hvc3Q+bm88L3NzbF92ZXJpZnlfaG9zdD4KICAgIDxzc2xfbWFuYWdlcl9jZXJ0Pi92YXIvb3NzZWMvZXRjL3NzbG1hbmFnZXIuY2VydDwvc3NsX21hbmFnZXJfY2VydD4KICAgIDxzc2xfbWFuYWdlcl9rZXk+L3Zhci9vc3NlYy9ldGMvc3NsbWFuYWdlci5rZXk8L3NzbF9tYW5hZ2VyX2tleT4KICAgIDxzc2xfYXV0b19uZWdvdGlhdGU+bm88L3NzbF9hdXRvX25lZ290aWF0ZT4KICA8L2F1dGg+CgogIDxjbHVzdGVyPiAKICAgIDxuYW1lPiBkb2NrZXItY2x1c3RlciA8L25hbWU+IAogICAgPCBub2RlX25hbWUgPiB3YXp1aF9tYXN0ZXIgPC9ub2RlX25hbWUgPiAKICAgIDxrZXk+IDE3ZjI5ZWQzMGMwODY0Y2U4MWI2ZjdiYTQ4MmI0MjhkIDwva2V5PiA8IS0tIEtleSBxdWUgZGViZSBzZXIgbGEgbWlzbWEgZW4gdG9kb3MgbG9zIG5vZG9zIC0tPgogICAgPG5vZGVfdHlwZT4gbWFzdGVyIDwvbm9kZV90eXBlPiAKICAgIDxwb3J0PiAxNTE2IDwvcG9ydD4gCiAgICA8YmluZF9hZGRyPiAwLjAuMC4wIDwgLyBiaW5kX2FkZHI+IAogICAgPG5vZGVzPiAKICAgICAgPG5vZGU+IG1hc3RlciA8L25vZGU+IAogICAgPC9ub2Rlcz4gCiAgICA8aGlkZGVuPiBubyA8L2hpZGRlbj4gCiAgICA8ZGlzYWJsZWQ+IG5vIDwvZGlzYWJsZWQ+IAo8L2NsdXN0ZXI+Cgo8L29zc2VjX2NvbmZpZz4=" | base64 -w0 -d > /var/containers/wazuh/wazuh/wazuh-config-mount/etc/ossec.conf
docker run --name=wazuh -d --link=logstash_wazuh:logstash -p 1514:1514/udp -p 1515:1515 -p 514:514/udp -p 55000:55000 -v /var/containers/wazuh/wazuh/var/ossec/data:/var/ossec/data:z -v /var/containers/wazuh/wazuh/etc/postfix:/etc/postfix:z -v /var/containers/wazuh/wazuh/etc/filebeat:/etc/filebeat:z -v /var/containers/wazuh/wazuh/wazuh-config-mount/etc/ossec.conf:/wazuh-config-mount/etc/ossec.conf -v /var/containers/wazuh/wazuh/etc/filebeat/filebeat.yml:/etc/filebeat/filebeat.yml:z wazuh/wazuh:3.6.1_6.4.2
echo "Wazuh creado"

#Creación y configuración de directorios para kibana
mkdir -p /var/containers/wazuh/elk/kibana/
echo "IyA9PT09PT09PT09PT09PT09PT09IGtpYmFuYToga2liYW5hLnltbCA9PT09PT09PT09PT09PT09PT09PT09ICMKI2tpYmFuYSBjb25maWd1cmF0aW9uIGZyb20ga2liYW5hLWRvY2tlci4Kc2VydmVyLm5hbWU6IGtpYmFuYQpzZXJ2ZXIuaG9zdDogIjAiCmVsYXN0aWNzZWFyY2gudXJsOiBodHRwOi8vZWxhc3RpY3NlYXJjaDo5MjAwICNEaXJlY2NpT24gSVAgZGVsIGNvbnRlbmVkb3IgZGUgZWxhc3RpY3NlYXJjaA==" | base64 -w0 -d > /var/containers/wazuh/elk/kibana/kibana.yml
docker run --name=kibana_wazuh --link=elasticsearch_wazuh:elasticsearch --link=logstash_wazuh:logstash --link=wazuh:wazuh -p 5601:5601 -d -v /var/containers/wazuh/elk/kibana/kibana.yml:/usr/share/kibana/config/kibana.yml:z wazuh/wazuh-kibana:3.6.1_6.4.2
echo "Kibana creado"

echo "Consulta http://localhost:5601"
